<?php

namespace Database\Seeders;

use App\Models\Reference\Dictionary;
use Illuminate\Database\Seeder;
use Illuminate\Support\Str;

class DictionarySeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Массив для сбора всех slug+type из сидера
        $seederKeys = [];

        $dictionaries = [
            // Тип сделки
            Dictionary::TYPE_DEAL_TYPE => [
                'Продажа квартир',
                'Продажа комнат',
                'Продажа домов',
                'Продажа земли',
                'Продажа коммерции',
                'Продажа паркинг/гараж',
                'Аренда квартир',
                'Аренда комнат',
                'Аренда домов',
                'Аренда земли',
                'Аренда коммерции',
                'Аренда паркинг/гараж',
            ],

            // Вид сделки
            Dictionary::TYPE_DEAL_KIND => [
                'Нотариальная',
                'Переуступка',
                'Отдел продаж',
            ],

            // Тип здания
            Dictionary::TYPE_BUILDING_TYPE => [
                'Новострой',
                'Старый фонд',
                'Сталинка',
                'Хрущёвка',
                'Чешка',
                'Панельный',
                'Старый фонд',
                'Московка',
                'Гостинка',
                'Сотовый',
                'Харьковка',
                'Югославка',
                'Бельгийка',
                'Общежитие',
                'Малосемейка',
            ],

            // Тип недвижимости
            Dictionary::TYPE_PROPERTY_TYPE => [
                'Квартира',
                'Пентхаус',
                'Квартира на земле',
                'Студия',
                'Комната',
                'Дом',
                'Таунхаус',
                'Дуплекс',
                'Часть дома',
                'Коттедж',
                'Земля под жилую застройку',
                'Земля коммерческого назначения',
                'Земля сельскохозяйственного назначения',
                'Офисное помещение',
                'Торговое помещение',
                'Складские помещения',
                'Производственные помещения',
                'Помещение свободного назначения',
                'Здание',
                'Готовый бизнес',
                'Паркинг',
                'Машино-место',
                'Гараж',
                'Бокс',
            ],

            // Состояние
            Dictionary::TYPE_CONDITION => [
                'С ремонтом',
                'Жилая',
                'От строителей',
                'Без ремонта',
            ],

            // Тип стен
            Dictionary::TYPE_WALL_TYPE => [
                'Кирпич',
                'Силикатный кирпич',
                'Панель',
                'Пеноблок',
                'Монолит',
                'Ракушечник (ракушняк)',
                'Монолитно-кирпичный',
                'Монолитно-блочный',
                'Дерево и кирпич',
                'Керамзитобетон',
                'Монолитно-каркасный',
                'Керамический блок',
                'Армированный железобетон',
                'Сборный железобетон',
                'Армированная 3D Панель',
                'Газоблок',
                'Бескаркасная',
                'СИП',
                'Сборно-монолитная',
                'Керамический кирпич',
                'Железобетон',
                'Облицовочный кирпич',
                'Каркасно-каменная',
                'Монолитный железобетон',
                'Блочно-кирпичный',
            ],

            // Отопление
            Dictionary::TYPE_HEATING_TYPE => [
                'Централизованное',
                'Индивидуальное газовое отопление',
                'Индивидуальное электрическое отопление',
                'Автономное (собственная котельная)',
                'Без отопления',
                'Комбинированное',
                'Другое',
                'Подогрев пола',
                'Печное / Каминное отопление',
                'Твердотопливное отопление',
                'Тепловой насос / альтернативное',
            ],

            // Количество комнат
            Dictionary::TYPE_ROOM_COUNT => [
                ['name' => '1 комната', 'value' => '1'],
                ['name' => '2 комнаты', 'value' => '2'],
                ['name' => '3 комнаты', 'value' => '3'],
                ['name' => '4 комнаты', 'value' => '4'],
                ['name' => '5 комнат', 'value' => '5'],
                ['name' => '6 комнат', 'value' => '6'],
                ['name' => '7 комнат', 'value' => '7'],
                ['name' => '8 комнат', 'value' => '8'],
                ['name' => '9 комнат', 'value' => '9'],
                ['name' => '10+ комнат', 'value' => '10+'],
            ],

            // Количество ванных
            Dictionary::TYPE_BATHROOM_COUNT => [
                ['name' => '1 ванная', 'value' => '1'],
                ['name' => '2 ванных', 'value' => '2'],
                ['name' => '3 ванных', 'value' => '3'],
                ['name' => '4 ванных', 'value' => '4'],
                ['name' => '5 ванных', 'value' => '5'],
                ['name' => '6 ванных', 'value' => '6'],
                ['name' => '7 ванных', 'value' => '7'],
                ['name' => '8 ванных', 'value' => '8'],
                ['name' => '9 ванных', 'value' => '9'],
                ['name' => '10+ ванных', 'value' => '10+'],
            ],

            // Высота потолков
            Dictionary::TYPE_CEILING_HEIGHT => [
                ['name' => 'До 2.5 м', 'value' => '2.5'],
                ['name' => '2.5 – 2.7 м', 'value' => '2.7'],
                ['name' => '2.8 – 3.0 м', 'value' => '3.0'],
                ['name' => '3.1 – 3.5 м', 'value' => '3.5'],
                ['name' => '3.6 – 4.0 м', 'value' => '4.0'],
                ['name' => '4.1 – 5.0 м', 'value' => '5.0'],
                ['name' => 'Выше 5.0 м', 'value' => '5.1'],
            ],

            // Год постройки
            Dictionary::TYPE_YEAR_BUILT => [
                ['name' => '2030+', 'value' => '2030'],
                ['name' => '2029', 'value' => '2029'],
                ['name' => '2028', 'value' => '2028'],
                ['name' => '2027', 'value' => '2027'],
                ['name' => '2026', 'value' => '2026'],
                ['name' => '2025', 'value' => '2025'],
                ['name' => '2024', 'value' => '2024'],
                ['name' => '2023', 'value' => '2023'],
                ['name' => '2022', 'value' => '2022'],
                ['name' => '2021', 'value' => '2021'],
                ['name' => '2020', 'value' => '2020'],
                ['name' => '2019', 'value' => '2019'],
                ['name' => '2018', 'value' => '2018'],
                ['name' => '2017', 'value' => '2017'],
                ['name' => '2016', 'value' => '2016'],
                ['name' => '2015', 'value' => '2015'],
                ['name' => '2014', 'value' => '2014'],
                ['name' => '2013', 'value' => '2013'],
                ['name' => '2012', 'value' => '2012'],
                ['name' => '2011', 'value' => '2011'],
                ['name' => '2010', 'value' => '2010'],
                ['name' => '2009', 'value' => '2009'],
                ['name' => '2008', 'value' => '2008'],
                ['name' => '2007', 'value' => '2007'],
                ['name' => '2006', 'value' => '2006'],
                ['name' => '2005', 'value' => '2005'],
                ['name' => '2004', 'value' => '2004'],
                ['name' => '2003', 'value' => '2003'],
                ['name' => '2002', 'value' => '2002'],
                ['name' => '2001', 'value' => '2001'],
                ['name' => '2000', 'value' => '2000'],
                ['name' => '1990-1999', 'value' => '1990'],
                ['name' => '1950-1989', 'value' => '1950'],
                ['name' => 'До 1949', 'value' => '1949'],
            ],

            // Особенности
            Dictionary::TYPE_FEATURE => [
                'От посредника',
                'Комиссия от владельца',
                'Госпрограммы',
                'Мебель',
                'Бытовая техника',
                'Кондиционер',
                'Балкон',
                'Лоджия',
                'Терраса',
                'Гараж',
                'Паркинг',
                'Подвал',
                'Чердак',
                'Охрана',
                'Консьерж',
                'Лифт',
                'Детская площадка',
                'Закрытая территория',
                'Видеонаблюдение',
                'Бассейн',
                'Сауна',
                'Камин',
                'Тёплый пол',
                'Панорамные окна',
                'Вид на море',
                'Вид на парк',
                'Первый этаж',
                'Последний этаж',
                'Двухуровневая',
            ],

            // Теги контактов
            Dictionary::TYPE_CONTACT_TAG => [
                'Собственник',
                'Посредник',
                'Агент',
                'Застройщик',
                'VIP',
                'Проблемный',
                'Постоянный клиент',
            ],

            // Тип контакта
            Dictionary::TYPE_CONTACT_TYPE => [
                'Эксклюзив \ Владелец',
                'Владелец  \  Представитель (Без комиссии )',
                'Агент (50/50)',
                'Девелопер',
            ],

        ];

        foreach ($dictionaries as $type => $items) {
            $sortOrder = 0;

            foreach ($items as $item) {
                $sortOrder += 10;

                // Если элемент - массив с name и value
                if (is_array($item)) {
                    $name = $item['name'];
                    $value = $item['value'] ?? null;
                } else {
                    $name = $item;
                    $value = null;
                }

                $slug = Str::slug($name);

                // Собираем ключи для синхронизации
                $seederKeys[] = $type . '|' . $slug;

                Dictionary::updateOrCreate(
                    [
                        'type' => $type,
                        'slug' => $slug,
                    ],
                    [
                        'type' => $type,
                        'name' => $name,
                        'value' => $value,
                        'slug' => $slug,
                        'sort_order' => $sortOrder,
                        'is_active' => true,
                    ]
                );
            }
        }

        // Синхронизация: удаляем записи которых нет в сидере
        $allTypes = array_keys($dictionaries);

        Dictionary::whereIn('type', $allTypes)
            ->get()
            ->each(function ($record) use ($seederKeys) {
                $key = $record->type . '|' . $record->slug;
                if (!in_array($key, $seederKeys)) {
                    $record->delete();
                }
            });
    }
}
